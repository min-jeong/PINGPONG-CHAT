<?xml version="1.0" encoding="UTF-8"?>
<query>
	<member>
		<addNewMember>
			INSERT INTO MEMBER (
									EMAIL
									, NAME
									, PASSWORD
								)
			VALUES				(
									?
									, ?
									, ?
								)			
		</addNewMember>
		
		<getMemberByIdAndPassword>
			SELECT 	*
			FROM 	MEMBER
			WHERE	EMAIL = ?
			AND		PASSWORD = ?
		</getMemberByIdAndPassword>
	
		<selectIdCount>
			SELECT COUNT(EMAIL)
			FROM   MEMBER
			WHERE  EMAIL = ?
		</selectIdCount>
		
		<checkPassword>
			SELECT *
			FROM   MEMBER
			WHERE  EMAIL = ?
		</checkPassword>
		
		<updateMember>
			UPDATE	MEMBER
			SET		PASSWORD = ?
					, NAME = ?
			WHERE	EMAIL = ?
		</updateMember>
		<updateMemberPhoto>
			UPDATE 	MEMBER
			SET 	PIC_PATH = ?
					, PIC_NAME = ?
			WHERE 	EMAIL = ?
		</updateMemberPhoto>
	</member>
	<chat>
      <insertChat>
         INSERT INTO CHAT (
               CHAT_ID
               , CHAT_DATE
               , NICK_NAME
               , DESCRIPTION
               , NOTICE
               , TEAM_ID
         )VALUES (
               'CH-'||TO_CHAR(SYSDATE, 'YYYYMMDDHH24')||'='||CHAT_ID_SEQ.NEXTVAL
               , TO_TIMESTAMP(?)
               , ?
               , ?
               , ''
               , 4
         )      
      </insertChat>
      
      <getAllChatByNickName>
         SELECT    CHAT_ID
               , CHAT_DATE
               , NICK_NAME
               , DESCRIPTION
               , NOTICE
               , TEAM_ID
         FROM   CHAT
         WHERE    NICK_NAME LIKE ?
         AND    TEAM_ID = 4
      </getAllChatByNickName>
      
      <getNickNamebyTeamId>
         SELECT   NICK_NAME
         FROM     CHAT
         WHERE    TEAM_ID = 4
         GROUP    BY NICK_NAME
      </getNickNamebyTeamId>
      
      <getTalkCountbyNickName>
         SELECT  COUNT(*), NICK_NAME
         FROM    CHAT
         GROUP   BY NICK_NAME;      
      </getTalkCountbyNickName>
      
      <deleteAllChatByTeamId>
         DELETE    CHAT
         WHERE   TEAM_ID = 4
      </deleteAllChatByTeamId>
      
      <getChatRateByTeamId>
	      SELECT  C2.NICK_NAME  NICKNAME  
	              , C2.CT/C1.CT  GCT 
	   	  FROM    (
	                  SELECT  COUNT(*) CT
	                  FROM    CHAT
	                    WHERE   TEAM_ID = ?
	                ) C1
	           ,
	           (      
	                 SELECT  NICK_NAME, COUNT(*) CT
	                 FROM    CHAT
	                 WHERE   TEAM_ID = ?
	                 GROUP   BY NICK_NAME
	          ) C2
      </getChatRateByTeamId>
      
      <getTimeChatCountByTeamId>
      		SELECT 		NIGHT_CHAT.NICK_NAME 
      					, NIGHT_CHAT.NC 
      					, MORNING_CHAT.MC
    		FROM 
        			   		 ( 
               			SELECT	 NICK_NAME,COUNT(*) NC
              			FROM  	 (
                        SELECT   NICK_NAME
                        		 , TO_CHAR( CHAT_DATE, 'HH24') 
                        FROM	 CHAT
                        WHERE 	 TO_CHAR( CHAT_DATE, 'HH24') BETWEEN '00' AND '03'
                        OR 		 TO_CHAR( CHAT_DATE, 'HH24') BETWEEN '22' AND '23'
                        AND 	 TEAM_ID = ?
                     		 ) 
                	    GROUP   BY NICK_NAME
         					 ) NIGHT_CHAT
         					 , 
          					 (
               		    SELECT  NICK_NAME
                		, COUNT(*) MC
                		FROM      	 ( 
                        SELECT 	 NICK_NAME
                        		, TO_CHAR( CHAT_DATE, 'HH24') 
                        FROM	 CHAT
                           		 WHERE TO_CHAR( CHAT_DATE, 'HH24') BETWEEN '05' AND '10'
                           		 AND   TEAM_ID = ?
                       				  ) 
                		GROUP   BY NICK_NAME
         							  ) MORNING_CHAT
   					 	WHERE	 NIGHT_CHAT.NICK_NAME = MORNING_CHAT.NICK_NAME
      </getTimeChatCountByTeamId>
      
      <getFirstChatCountByTeamId>
     		 SELECT REPLY_NICK, SUN_TALK, SUM_ST
				FROM    (
           SELECT  SUM(COUNT_TALK) SUM_ST
           FROM (
                    SELECT REPLY_NICK, ROUND(MI * 1 * 24 * 60) MI , COUNT(*) COUNT_TALK            
                    FROM  
                        (
                        SELECT C1.NICK_NAME REPLY_NICK, ROUND(C1.CHAT_DATE - C2.CHAT_DATE, 15) AS MI
                        FROM CHAT C1 , CHAT C2
                        WHERE C1.CHAT_ID = C2.CHAT_ID + 1
                        AND   C1.NICK_NAME != C2.NICK_NAME
                        AND   C1.TEAM_ID = ?
                        AND   C2.TEAM_ID = ?
                        ) 
                    WHERE ROUND(MI * 1 * 24 * 60) >= 180
                    GROUP BY REPLY_NICK, MI
                    ORDER BY MI, REPLY_NICK
                )
        ) C1
        ,
        (
           SELECT REPLY_NICK, SUM(COUNT_TALK) SUN_TALK
           FROM   (
                   SELECT REPLY_NICK, ROUND(MI * 1 * 24 * 60) MI , COUNT(*) COUNT_TALK            
                    FROM  
                        (
                        SELECT C1.NICK_NAME REPLY_NICK, ROUND(C1.CHAT_DATE - C2.CHAT_DATE, 15) AS MI
                        FROM  CHAT C1 , CHAT C2
                        WHERE C1.CHAT_ID = C2.CHAT_ID + 1
                        AND   C1.NICK_NAME != C2.NICK_NAME
                        AND   C1.TEAM_ID = ?
                        AND   C2.TEAM_ID = ?
                        ) 
                    WHERE ROUND(MI * 1 * 24 * 60) >= 180
                    GROUP BY REPLY_NICK, MI
                    ORDER BY MI, REPLY_NICK
                   )  
            GROUP   BY REPLY_NICK
        ) C2
      </getFirstChatCountByTeamId>
      
      <getFastReplyChatCountByTeamId>
      SELECT REPLY_NICK, COUNT_TALK, SUM_TALK, ACT
		FROM (
        SELECT REPLY_NICK, ROUND(MI * 1 * 24 * 60) MI , COUNT(*) COUNT_TALK  
        FROM  
            (
            SELECT C1.NICK_NAME REPLY_NICK, ROUND(C1.CHAT_DATE - C2.CHAT_DATE, 15) AS MI
            FROM CHAT C1 , CHAT C2
            WHERE C1.CHAT_ID = C2.CHAT_ID + 1
            AND   C1.NICK_NAME != C2.NICK_NAME
            AND   C1.TEAM_ID = ?
            AND   C2.TEAM_ID = ?
            ) 
            
            
        WHERE MI &gt;= 0
        AND   MI &lt;= 180 
        GROUP BY REPLY_NICK, MI
        ORDER BY MI, REPLY_NICK
      ) TA
      ,
      (
        SELECT  ROUND(MI * 1 * 24 * 60) MI
        FROM    (
                    SELECT C1.NICK_NAME REPLY_NICK, ROUND(C1.CHAT_DATE - C2.CHAT_DATE, 15) AS MI
                    FROM CHAT C1 , CHAT C2
                    WHERE C1.CHAT_ID = C2.CHAT_ID + 1
                    AND   C1.NICK_NAME != C2.NICK_NAME
                    AND   C1.TEAM_ID = ?
                    AND   C2.TEAM_ID = ?
                )
        WHERE   ROWNUM = 1
        ORDER   BY MI    
      ) MIN_MI   
      , 
      (
           SELECT MI,AVG(COUNT_TALK) ACT ,SUM(COUNT_TALK) SUM_TALK
           FROM    (
                        SELECT REPLY_NICK, ROUND(MI * 1 * 24 * 60) MI , COUNT(*) COUNT_TALK            
                        FROM  
                            (
                            SELECT C1.NICK_NAME REPLY_NICK, ROUND(C1.CHAT_DATE - C2.CHAT_DATE, 15) AS MI
                            FROM CHAT C1 , CHAT C2
                            WHERE C1.CHAT_ID = C2.CHAT_ID + 1
                            AND   C1.NICK_NAME != C2.NICK_NAME
                            AND   C1.TEAM_ID = ?
                            AND   C2.TEAM_ID = ?
                            ) 
                        WHERE ROUND(MI * 1 * 24 * 60) &gt;= 0
                        AND   ROUND(MI * 1 * 24 * 60) &lt;= 180 
                        GROUP BY REPLY_NICK, MI
                        ORDER BY MI, REPLY_NICK
                  )
           GROUP BY    MI
           ORDER    BY MI
      ) AVG_MI 
			WHERE TA.MI = MIN_MI.MI
			AND   TA.MI = AVG_MI.MI
</getFastReplyChatCountByTeamId>

<getHowManyChatByTeamId>
		SELECT  		C2.NICK_NAME NICK_NAME
						,  C2.SUM_TEXT SUM_TEXT
						, C1.AVG_TEXT AVG_TEXT 
						, TOTAL_COUNT
		FROM    	(
         				  SELECT  AVG(SUM(LENGTH(DESCRIPTION))) AVG_TEXT
          				  FROM    CHAT
          				  WHERE   TEAM_ID = ?
         				  GROUP   BY NICK_NAME
       				 ) C1
       				 ,(
            SELECT NICK_NAME, SUM(LENGTH(DESCRIPTION)) SUM_TEXT
            FROM    CHAT
            WHERE   TEAM_ID = ?
            GROUP   BY NICK_NAME
      				  ) C2
       				 ,( 
            SELECT COUNT(*) TOTAL_COUNT
            FROM CHAT
            WHERE TEAM_ID = ?
       				 )      
</getHowManyChatByTeamId>

<getSmileChatByTeamId>

SELECT  *
FROM    (
            SELECT   NICK_NAME, COUNT(*) POSI_COUNT 
            FROM     CHAT   
            WHERE    TEAM_ID = ?
            AND      DESCRIPTION LIKE '%ㅋㅋㅋ%' 
            OR       DESCRIPTION LIKE '%ㅎㅎㅎ%'
            OR       DESCRIPTION LIKE '%캬캬%'
            OR       DESCRIPTION LIKE '%크크크%'
            OR       DESCRIPTION LIKE '%^^%'
            GROUP   BY NICK_NAME
        ) POSI
        ,
        (
            SELECT SUM(P_COUNT) SUM_POSI
            FROM
            (
                SELECT   NICK_NAME, COUNT(*) P_COUNT
                FROM     CHAT   
                WHERE    TEAM_ID = ?
                AND      DESCRIPTION LIKE '%ㅋㅋㅋ%' 
                OR       DESCRIPTION LIKE '%ㅎㅎㅎ%'
                OR       DESCRIPTION LIKE '%캬캬%'
                OR       DESCRIPTION LIKE '%크크크%'
                OR       DESCRIPTION LIKE '%^^%'
                GROUP   BY NICK_NAME
            ) SUM_POSI
        )  
</getSmileChatByTeamId>

<getAngryChatByTeamId>
SELECT  *
FROM    (
            SELECT   NICK_NAME, COUNT(*) BAD_COUNT
            FROM     CHAT   
            WHERE    TEAM_ID = ?
            AND       DESCRIPTION LIKE '%ㅡㅡ%' 
            OR       DESCRIPTION LIKE '%^'    
            OR       DESCRIPTION LIKE '%--%'     
            GROUP   BY NICK_NAME
        ) BAD
        ,
        (
            SELECT SUM(B_COUNT) SUM_BAD
            FROM
            (
                SELECT   NICK_NAME, COUNT(*) B_COUNT
                FROM     CHAT   
                WHERE    TEAM_ID = ? 
                AND      DESCRIPTION LIKE '%ㅡㅡ%' 
                OR       DESCRIPTION LIKE '%^'    
                OR       DESCRIPTION LIKE '%--%'  
                GROUP   BY NICK_NAME
            ) SUM_BAD
        )  
</getAngryChatByTeamId>

<getDayChatByTeamId>
			SELECT 		NICK_NAME
						, COUNT_TALK
						, DAY_CHAT.CHAT_DAY
						, SUM_COUNT_TALK
			FROM   		 (
            SELECT  	COUNT(*) COUNT_TALK, TO_CHAR(CHAT_DATE,'YYYY-MM-DD') CHAT_DAY, NICK_NAME 
            FROM 		CHAT
            WHERE   	TEAM_ID = ?
            GROUP BY 	TO_CHAR(CHAT_DATE,'YYYY-MM-DD'), NICK_NAME
            ORDER BY 	TO_CHAR(CHAT_DATE,'YYYY-MM-DD')
      					)	DAY_CHAT
       					,
      			  	    (
            SELECT SUM(COUNT_TALK) SUM_COUNT_TALK, CHAT_DAY
            FROM  		(
                        SELECT  COUNT(*) COUNT_TALK, TO_CHAR(CHAT_DATE,'YYYY-MM-DD') CHAT_DAY, NICK_NAME 
                        FROM CHAT
                        WHERE   TEAM_ID = ?
                        GROUP   BY TO_CHAR(CHAT_DATE,'YYYY-MM-DD'), NICK_NAME
                        ORDER   BY TO_CHAR(CHAT_DATE,'YYYY-MM-DD')
                    )
            GROUP   BY CHAT_DAY     
            ORDER   BY CHAT_DAY
       				) SUM_DAY_CHAT
			WHERE 	DAY_CHAT.CHAT_DAY = SUM_DAY_CHAT.CHAT_DAY
</getDayChatByTeamId>

      
   </chat>
</query>